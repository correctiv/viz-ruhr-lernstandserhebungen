"use strict";var _color=["#f9c280","#dfad71","#c59962","#ab8454","#917045","#775b36","#5e4728"],subjects={math:"Mathe",german:"Deutsch",english_listen:"Englisch (Hören)",english_read:"Englisch (Lesen)"};window.renderMultiMaps=function(){var e=[0,35];d3.json("./data/rvr_districts.topo.json",function(t){var n=topojson.feature(t,t.objects.rvr_districts);d3.csv("./data/data.csv",function(t){d3.playbooks.choroplethMap.defaults({color:_color,nullColor:"#ededed",cssNamespace:"multi-map",height:480,width:846,data:t,geoData:n,yExtent:e,getId:function(e){return e.properties.RS},responsiveSvg:!0});var r={},i=function(e,t,n){if(Object.keys(r).filter(function(e){return e!==t}).map(function(e){r[e].hilight(n)}),!e){var i=r[Object.keys(r)[0]].control();i.trigger(riot.EVT.updateInfobox,n),i.trigger(riot.EVT.updateSelector,n)}},a=d3.select("#multi-maps"),l=0;Object.keys(subjects).map(function(e){var t="multi-maps--"+e;a.append("div").attr("id",t).attr("class","multi-map__container").append("h4").attr("class","multi-map__title").text(subjects[e]),r[e]=d3.playbooks.choroplethMap({elementId:t,yCol:e+"__risiko_rel"}).render(),l?r[e].control().on(riot.EVT.mouseover,function(t){var n=t.data;return i(!1,e,n)}):(r[e].infobox({element:"#multi-maps-infobox",template:'\n              <h4 class="cor-viz-ls__infobox-title">Anteil der Risikoschüler</h4>\n              <p>in {GEN}</p>\n              <dl class="fixme">\n                <dt>{math__risiko_rel} %</dd>\n                <dd>Mathe</dt>\n                <dt>{german__risiko_rel} %</dd>\n                <dd>Deutsch</dt>\n                <dt>{english_listen__risiko_rel} %</dd>\n                <dd>Englisch (Hören)</dt>\n                <dt>{english_read__risiko_rel} %</dd>\n                <dd>Englisch (Lesen)</dt>\n              </dl>\n              <p class="data--small">Teilnehmer: {participating}</p>\n            '}).legend({wrapperTemplate:'\n                <h4 class="multi-map__legend-title">Anteil in %</h4>\n                <div class="multi-map__legend-items">\n                  {body}\n                </div>',itemTemplate:'<span class="multi-map__legend-item" style="background-color:{color};">{label}</span>',element:"#multi-maps-legend"}).selector({element:"#multi-maps-selector",getLabel:function(e){return e.GEN}}),r[e].control().on(riot.EVT.updateInfobox,function(t){return i(!0,e,t)})),l++})})})},window.renderMultiBars=function(){var e=d3.select("#multi-bars");d3.csv("./data/schulformen.csv",function(t){var n=["Gymnasium","Hauptschule","Realschule","Schulen des längeren gemeinsamen Lernens"],r=Object.keys(subjects).map(function(e){return subjects[e]});r.splice(0,0,null);var i=function(e){var n=t.filter(function(t){return t.schulform==e});return r.map(function(e){return e?n.find(function(t){return t.fach==e}):e})},a=function(e){return Object.keys(e).filter(function(e){return e.indexOf("niveau")>-1&&e.indexOf("6")<0}).sort().reverse().map(function(t){return{y:t,x:e[t]}})};e.append("div").attr("class","multi-bars__row multi-bars__row--header").selectAll("div").data(r).enter().append("div").attr("class","multi-bars__cell").classed("multi-bars__cell--empty",function(e){return!e}).text(function(e){return e}),e.append("div").selectAll("div").data(n).enter().append("div").attr("class","multi-bars__row multi-bars__row--section").html(function(e){return"<h3>"+e+"</h3>"}).append("div").selectAll("div").data(function(e){return i(e)}).enter().append("div").attr("class","multi-bars__cell").classed("multi-bars__cell--chart",function(e){return e}).classed("multi-bars__cell--empty",function(e){return!e}).append("div").attr("id",function(e){return e&&e.chart_id}),t.map(function(e){d3.playbooks.horizontalBarChart({elementId:e.chart_id,data:a(e),color:function(e){return e.y.indexOf("0")<0&&e.y.indexOf("1")<0?_color[0]:_color[3]},barMargin:10,margin:{top:0,right:0,bottom:0,left:0},showXAxis:!1,showYAxis:!1,getXDomain:function(){return[0,75]},responsiveSvg:!0}).render()})})};
